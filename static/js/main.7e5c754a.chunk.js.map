{"version":3,"sources":["AltaAuth/index.tsx","Pages/Home.tsx","utility/reportWebVitals.js","index.js","config.js","Pages/LoggedIn.js"],"names":["AuthContext","React","createContext","Consumer","AuthProvider","config","children","configureManager","location","window","autoSignIn","useState","setLoaded","userData","setUserData","useEffect","callback","style","document","createElement","rel","href","head","appendChild","element","setAttribute","onload","loadScript","altaApi","init","oidc","events","addUserLoaded","user","console","log","addUserUnloaded","checkSignInCallback","a","getUser","expired","signIn","then","result","catch","error","Provider","value","undefined","useAuth","useContext","LoginButton","small","type","auth","isLogin","username","profile","Username","className","onClick","signOut","alt","src","Header","display","alignItems","justifyContent","width","height","position","top","left","margin","lineHeight","marginLeft","textOverflow","whiteSpace","marginRight","Friend","created_at","id","Date","toDateString","reportWebVitals","onPerfEntry","Function","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","render","StrictMode","path","component","friends","setFriends","setError","fetch","sub","length","map","friend","i","key","getElementById"],"mappings":"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","file":"static/js/main.7e5c754a.chunk.js","sourcesContent":["import React from 'react';\r\n\r\nimport { User } from 'oidc-client';\r\n\r\nimport { AuthContextProps, AuthProviderProps, RequireAuthProps } from './interfaces';\r\n\r\nconst AuthContext = React.createContext<AuthContextProps | null>(null);\r\n\r\nfunction loadScript(callback:()=>void)\r\n{\r\n    var style = document.createElement(\"link\");\r\n    style.rel = \"stylesheet\";\r\n    style.href = \"https://accounts.townshiptale.com/includes/altastyle.css\";\r\n    document.head.appendChild(style);\r\n\r\n    var element = document.createElement(\"script\");\r\n    element.setAttribute(\"src\", \"https://accounts.townshiptale.com/includes/altaapi.js\");\r\n    document.head.appendChild(element);\r\n    element.onload = callback;\r\n}\r\n\r\ndeclare global {\r\n    interface Window {\r\n        altaApi:any;\r\n    }\r\n}\r\n\r\nexport const AuthConsumer = AuthContext.Consumer;\r\n\r\nexport const AuthProvider: React.FC<AuthProviderProps> = ({\r\n    config, \r\n    children, \r\n    configureManager, \r\n    location=window.location, \r\n    autoSignIn=false}) =>\r\n{\r\n    const [loaded, setLoaded] = React.useState(false);\r\n    const [userData, setUserData] = React.useState<User | null>(null);\r\n\r\n    React.useEffect(() =>\r\n    {   \r\n        loadScript(() =>\r\n        {\r\n            window.altaApi.init(config, () =>\r\n            {\r\n                configureManager && configureManager(window.altaApi.oidc);\r\n                \r\n                window.altaApi.oidc.events.addUserLoaded((user:any) => { console.log(\"User loaded\"); console.log(user); setUserData(user); });\r\n                window.altaApi.oidc.events.addUserUnloaded(() => { console.log(\"User unloaded\"); setUserData(null); });\r\n            \r\n                window.altaApi.checkSignInCallback(location);\r\n\r\n                setLoaded(true);\r\n            });\r\n        });\r\n    },\r\n    []);\r\n\r\n    React.useEffect(() =>\r\n    {\r\n        if (!!window.altaApi)\r\n        {\r\n            if (window.altaApi.checkSignInCallback(location))\r\n            {\r\n                return;\r\n            }\r\n\r\n            const getUser = async () =>\r\n            { \r\n                var user = await window.altaApi.getUser();\r\n\r\n                if (!!user && !user.expired && !userData)\r\n                {\r\n                    setUserData(user);\r\n                }\r\n                else if ((!user || user.expired) && autoSignIn)\r\n                {\r\n                    console.log(\"SIGNIN\");\r\n                    console.log(user);\r\n\r\n                    window.altaApi.signIn()\r\n                    .then((result:any) => console.log(result))\r\n                    .catch((error:any) => console.error(error));\r\n                }\r\n            }\r\n\r\n            getUser();\r\n        }\r\n    },\r\n    [location, !!window.altaApi]);\r\n\r\n    return <AuthContext.Provider\r\n        value={!!window.altaApi ? {...window.altaApi, userData } : undefined}>\r\n        {children}\r\n    </AuthContext.Provider>\r\n}\r\n\r\n\r\nexport const useAuth = () => {\r\n    return React.useContext<AuthContextProps|null>(AuthContext);\r\n  };\r\n\r\n/**\r\n * A public higher-order component to access the imperative API\r\n */\r\nexport function withAuth<P extends AuthContextProps>(\r\n    Component: React.ComponentType<P>,\r\n  ): React.ComponentType<Omit<P, keyof AuthContextProps>> {\r\n    const displayName = `withAuth(${Component.displayName || Component.name})`;\r\n    const C: React.FC<Omit<P, keyof AuthContextProps>> = (props) => {\r\n      const auth = useAuth();\r\n  \r\n      return <Component {...(props as P)} {...auth} />;\r\n    };\r\n  \r\n    C.displayName = displayName;\r\n  \r\n    return C;\r\n  }\r\n  \r\n  \r\nexport const RequireAuth : React.FC<RequireAuthProps> = ({LoggingInComponent, children}) =>\r\n{\r\n    const auth = useAuth();\r\n\r\n    React.useEffect(() =>\r\n    {\r\n        if (!!auth?.oidc && !auth.userData)\r\n        {\r\n            auth?.signIn()\r\n            .then(result => console.log(result))\r\n            .catch(error => console.error(error));\r\n        }\r\n    },\r\n    [!!auth?.oidc, auth?.userData]);\r\n\r\n    if (!auth?.userData)\r\n    {\r\n        if (!!LoggingInComponent)\r\n        {\r\n            const Component = LoggingInComponent as any;\r\n\r\n            return <Component retry={() => auth?.signIn()}/>;\r\n        }\r\n        else\r\n        {\r\n            return <div>\r\n                <h1>Showing login in popup.</h1>\r\n                <button onClick={() => \r\n                    auth?.signIn()\r\n                    .then(result => console.log(result))\r\n                    .catch(error => console.error(error))}>Click here if it doesn't appear.</button>\r\n            </div>\r\n        }\r\n    }\r\n\r\n    return <>\r\n            {children}\r\n        </>;\r\n}\r\n\r\n\r\nexport function LoginButton({small = false, style, type='auto'} : {small?:Boolean, style?: React.CSSProperties, type?:'auto'|'login'|'logout'})\r\n{\r\n    var auth = useAuth();\r\n\r\n    var isLogin = type === 'auto' ? !auth?.userData : (type === 'login');\r\n\r\n    var username = auth?.userData?.profile?.Username; \r\n\r\n    var onClick = () =>\r\n    {\r\n        if (!auth?.oidc)\r\n        {\r\n            console.error(\"Can't login until alta login library is loaded.\");\r\n            return;\r\n        }\r\n\r\n        var login = isLogin ? auth.signIn : auth.signOut;\r\n\r\n        login().then(console.log).catch(console.error);\r\n    }\r\n    \r\n    var className = isLogin ? 'alta_loginWithAlta' : 'alta_loginWithAlta alta_loggedIn';\r\n\r\n    return <div className={className} style={style}>\r\n        <button onClick={onClick}>\r\n            <img alt='icon1' src='https://accounts.townshiptale.com/icon.svg'/>\r\n            <img alt='icon2' src='https://accounts.townshiptale.com/icon.svg'/>\r\n            <span className=\"alta_noHover\">{isLogin ? (small ? \"Login\" : \"Login with Alta\") : username}</span>\r\n            <span className=\"alta_hover\">{isLogin ? (small ? \"Login\" : \"Login with Alta\") : \"Logout\"}</span>\r\n        </button>\r\n    </div>\r\n}","import React from 'react';\n\nimport { useAuth, LoginButton } from '../AltaAuth';\n\n\n\nfunction Header()\n{\n    return <div style={{display: 'flex', alignItems:'center',  justifyContent: 'space-between', width: '100%', height: '60px', position: 'absolute', top:'0', left:'0'}}>\n        <h2 style={{margin: '0', height:'50px', lineHeight:'50px', marginLeft: '20px', textOverflow: 'ellipsis', whiteSpace: 'nowrap'}}>ATT Friend Manager</h2>\n        {<LoginButton style={{marginRight: '20px'}}/>}\n    </div>\n}\n\nfunction Friend({username, id, created_at} : {username:String, id:number, created_at:string})\n{\n    return <div>\n        <b>{username}</b><br/>\n        <code>Friends since {new Date(created_at).toDateString()}</code>\n        <br/>\n        <br/>\n    </div>\n}\n\nexport default function Home() \n{\n    var auth = useAuth();\n\n    var [friends, setFriends] = React.useState<undefined|any[]>();\n    var [error, setError] = React.useState<undefined|any>();\n\n    React.useEffect(() =>\n    {\n        setError(undefined);\n\n        auth?.fetch('GET', 'friends')\n        .then(setFriends)\n        .catch(setError);\n    },\n    [auth?.userData?.profile.sub])\n\n\n    if (!auth?.userData)\n    {\n        return <div>\n            <Header/>\n            <h4>Login to manage your friends</h4>\n        </div>\n    }\n\n  return (\n    <div>\n        <Header/>\n        {friends === undefined ? <p>Loading...</p> : (friends?.length == 0 ? \"No friends\" : friends.map((friend, i) => <Friend {...friend} key={i}/>))}\n    </div>\n  );\n}","const reportWebVitals = onPerfEntry => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\n\nimport Home from './Pages/Home';\nimport LoggedIn from './Pages/LoggedIn';\n\nimport reportWebVitals from './utility/reportWebVitals';\n\nimport { Switch, HashRouter, Route } from 'react-router-dom';\nimport { AuthProvider } from './AltaAuth';\n\nimport config from './config';\n\n\nReactDOM.render(\n  <React.StrictMode>\n    <AuthProvider config={config} autoSignIn>\n        <HashRouter>\n            <Switch>\n                <Route path={'/logged-in'} component={LoggedIn}/>\n                <Route component={Home}/>\n            </Switch>\n        </HashRouter>\n    </AuthProvider>\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\nreportWebVitals();\n","export default {\r\n    \"endpoint\" : \"local\",\r\n    \"client_id\": \"client_93258882-27bf-4dde-9efd-c7c8b7a14d78\",\r\n    \"scope\": \"openid friend.add friend.view\",\r\n    \"redirect_uri\": \"https://alta-vr.github.io/Demos-ATT-Friend-Manager/#/logged-in\"\r\n}","import React from 'react';\n\nexport default function LoggedIn() \n{\n  return (\n    <div>\n    Logged In... You may close this window.\n    </div>\n  );\n}"],"sourceRoot":""}